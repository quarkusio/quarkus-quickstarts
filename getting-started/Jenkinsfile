pipeline {
    agent any
    stages {
        stage('CI/CD Pipeline') {
            steps {
                echo 'Limpando o workspace para garantir um ambiente limpo...'
                cleanWs()
                
                script {
                    def targetEnvironment = 'des' // Valor padr√£o para a branch de dev
                    if (env.BRANCH_NAME == 'main') {
                        targetEnvironment = 'prd'
                    }

                    echo "Iniciando a pipeline para o ambiente: ${targetEnvironment}"
                    dir('getting-started') {
                        // Passa o ambiente como argumento para o script
                        sh "./pipeline.sh ${targetEnvironment}"
                    }
                }
            }
        }
    }
}